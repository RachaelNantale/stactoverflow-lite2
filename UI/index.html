<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible">
    <link rel="stylesheet" href="asserts/main.css">
    <title>StackOverflow</title>


</head>

<body>
    <header>
        <h2>Stack Overflow-lite</h2>
        <input type="text" placeholder="Search..">
    </header>

    <section>
        <nav>
            <ul>
                <li>
                    <a href="index.html">Home</a>
                </li>
                <li>
                    <a href="questions.html">Profile</a>
                </li>
                <li>
                    <a href="login.html">Logout</a>
                </li>
               

            </ul>
        </nav>
                
        <article>
        <button id="getQuestions" class="btn-1">Top Questions</button>
            <h1>Ask A Question</h1>
            <form id="askQuestion">
        <label>Title</label><br>
        <input type="text" class="input-fields" placeholder="What's your programming question. Be specific" id="title"><br><br>
        <label>Body</label><br>
        <textarea rows="7" cols="14" id="description"></textarea><br><br>
        <label>Tags</label><br>
        <input type="text" class="input-fields" placeholder="Atleast one tag" id="tags"><br><br>
        <button type="submit" class="btn" formaction="questions.html">Post Your Question </button>

        
    </form>
    </article>

        <div class="seconddiv">
                <div id="output" class="innerdiv"> </div>
            </div>
    </section>
    <script>
        document.getElementById('getQuestions').addEventListener('click', getQuestions);
        document.getElementById('askQuestion').addEventListener('submit', askQuestion);

        function getQuestions() {
            
            fetch('http://127.0.0.1:5000/api/v1/questions')
                 .then((response) => response.json())
                 .then((data) => {
                    let output = '<h2> Top Questions </h2>';
                    data.message.forEach(function (questions) {
                        output += `
                    <div>
                    <h3  onclick="getSingleQuestion(${questions.Question_ID})"> Title: ${questions.title}<h3>
                    <p> Description: ${questions.description}</p>
                    <p> Tags: ${questions.tags}</p>
                    <hr>
                    
                    </div>
                        `;
                    });
                    document.getElementById('output').innerHTML = output;
                    
               });
        }

        let url = "http://127.0.0.1:5000/api/v1/questions";
        fetch(url,
        {
            'method': "GET",
            'headers':{
            'Accept':"application/json, */*", 
            'content-type':"application/json"
            }
        })
        .then (response =>response.json())
        .then (data => {console.log(data)})

        function askQuestion(e){
            e.preventDefault();
            let title = document.getElementById('title').value;
            let description = document.getElementById('description').value;
            let tags = document.getElementById('tags').value;
            let payload = localStorage.getItem('token');
           
    
            fetch('http://127.0.0.1:5000/api/v1/questions',
            {
                method: 'POST',
                headers: {
                    "Accept": "application/json, */*",
                    "Content-type": "application/json",
                    "Authorization": `Bearer ${payload}`
                },
                body: JSON.stringify({title:title, description:description, tags:tags})
            })
            .then((response) => response.json())
            .then((data) => {console.log(data)
                if (data.message === "Created succesfully") {
                    alert('question created succesfully');
                    window.location.href = 'questions.html'
                    }
                else if(data.message === "Question already exists"){
                    alert("Sorry question already asked");
                }

                else {alert(data.message)}
            })
        }

        //function for getting a single question
        let payload = localStorage.getItem('token');
        function getSingleQuestion(Question_ID){

            fetch('http://127.0.0.1:5000/api/v1/questions/' + Question_ID,
            {
                method: 'GET',
                headers: {
                    "Accept": "application/json, */*",
                    "Content-type": "application/json",
                    "Authorization": `Bearer ${payload}`
                }
            })
            .then((response) => response.json())
           .then((data) => {
                let output = '<h2> Answers </h2>';
                
                    console.log(data)
                })
       }
                
                //answer.forEach(function (answers) {
                // output += `
                //     <ul>
                // <li><a href="questions.html?question_id=${QuestionID}&answer_id=${AnswerID}">${answers.answer}(${answer.status})</a></li>
                // </ul>
                //`
          
            // localStorage.setItem("QuestionID", QuestionID);
            // console.log(answer);
            // document.getElementById('asked-qn').innerHTML = `<div class="asked-qn-heading">${data[0]}</div>`
            // document.getElementById('answers-sector').innerHTML = output;
            // }


    </script>
    <footer>
        <p>&copy; StackOverflow</p>
    </footer>

</body>

</html>